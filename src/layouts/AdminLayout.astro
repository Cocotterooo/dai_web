---
import Layout from "./Layout.astro";
import AdminSidebar from "@/components/admin/adminSidebar/AdminSidebar.astro";

export interface Props {
    title?: string;
}

const { title = "Panel de Administración" } = Astro.props;

const user = Astro.locals.user;
const userRoleIds = Astro.locals.userRoleIds || [];
const isAuthenticated = !!user;

// Verificar si el usuario tiene permisos de admin
const isAdmin = ((userRoleIds as unknown) as string[]).includes('admin') || ((userRoleIds as unknown) as string[]).includes('dai_communication_coord');

// Si no está autenticado o no es admin, redirigir
if (!isAuthenticated) {
    return Astro.redirect('/auth');
}

if (!isAdmin) {
    return Astro.redirect('/profile?error=insufficient_permissions');
}

// Obtener la ruta actual para highlighting
const currentPath = Astro.url.pathname;
---

<Layout title={title}>
    <div class="min-h-screen  flex">
        <!-- Sidebar Component -->
        <AdminSidebar currentPath={currentPath} />

        <!-- Contenido principal -->
        <main class="flex-1 ml-64 pt-20 min-h-screen">
            <div class="p-6">
                <slot />
            </div>
        </main>
    </div>
</Layout>