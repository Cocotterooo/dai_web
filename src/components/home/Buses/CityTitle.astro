---
---

<div class="flex flex-col sm:flex-row sm:justify-between">
    <div id="industriales-title">
        <h2 class="text-3xl text-azul-brillante text-center sm:text-start">Sede Ciudad</h2>
        <p class="text-lg text-center sm:text-start">Parada delante del Instituto</p>
    </div>
    <div id="comercio-title">
        <h2 class="text-3xl text-azul-brillante text-center sm:text-start">Sede Ciudad</h2>
        <p class="text-lg text-center sm:text-start">Parada delante de Comercio</p>
    </div>
    <div class="flex justify-center sm:justify-end w-100%">
        <div id="city-buses-selector" class="flex gap-5 font-medium bg-color-azul-oscuro border border-dai/30 h-fit w-fit rounded-xl py-2 px-2 items-center relative scale-80 sm:scale-100">
            <div
                id="bus-backdrop"
                class="-z-10 rounded absolute bg-dai/20
                translate-x-(--left) translate-y-(--top)
                h-(--height) w-(--width)
                transition-all duration-200 
                ease-in-out left-0 top-0">
            </div>
            <ul class="flex flex-row items-center">
                <li>
                    <button id="bus-industriales-button" class="relative z-10 py-1 px-4 cursor-pointer hover:text-dai transition-colors duration-400">
                        <span>Industriales</span>
                    </button>
                </li>
                <li>
                    <button id="bus-comercio-button" class="relative z-10 py-1 px-4 cursor-pointer hover:text-dai transition-colors duration-400">
                        <span>Comercio</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</div>

<script type="module" is:inline>
    function initializeCitySelector() {
        const busComercioButton = document.querySelector('#bus-comercio-button')
        const busIndustrialesButton = document.querySelector('#bus-industriales-button')
        const busBackdrop = document.querySelector('#bus-backdrop')
        const industrialesTable = document.querySelector('#industriales-table')
        const industrialesTitle = document.querySelector('#industriales-title')
        const comercioTitle = document.querySelector('#comercio-title')
        const comercioTable = document.querySelector('#comercio-table')

        if (!busComercioButton || !busIndustrialesButton || !busBackdrop) return;

        // Limpiar event listeners existentes
        const oldIndustrialesButton = busIndustrialesButton.cloneNode(true);
        busIndustrialesButton.parentNode.replaceChild(oldIndustrialesButton, busIndustrialesButton);
        
        const oldComercioButton = busComercioButton.cloneNode(true);
        busComercioButton.parentNode.replaceChild(oldComercioButton, busComercioButton);

        // Obtener referencias actualizadas
        const newIndustrialesButton = document.querySelector('#bus-industriales-button');
        const newComercioButton = document.querySelector('#bus-comercio-button');

        // Inicializa el backdrop con el botón de Industriales
        const initializeBackdrop = (button) => {
            const { offsetTop, offsetLeft, offsetWidth, offsetHeight } = button
            busBackdrop.style.setProperty('--left', `${offsetLeft}px`)
            busBackdrop.style.setProperty('--top', `${offsetTop}px`)
            busBackdrop.style.setProperty('--width', `${offsetWidth}px`)
            busBackdrop.style.setProperty('--height', `${offsetHeight}px`)
        }

        // Function to update the backdrop position and size
        const updateBackdrop = (button) => {
            const { offsetTop, offsetLeft, offsetWidth, offsetHeight } = button
            busBackdrop.style.setProperty('--left', `${offsetLeft}px`)
            busBackdrop.style.setProperty('--top', `${offsetTop}px`)
            busBackdrop.style.setProperty('--width', `${offsetWidth}px`)
            busBackdrop.style.setProperty('--height', `${offsetHeight}px`)
        }

        // Muestra u oculta las tablas según el botón seleccionado
        const showTable = (titleToShow, tableToShow) => {
            if (industrialesTable) industrialesTable.classList.add('hidden')
            if (industrialesTitle) industrialesTitle.classList.add('hidden')
            if (comercioTable) comercioTable.classList.add('hidden')
            if (comercioTitle) comercioTitle.classList.add('hidden')
            if (titleToShow) titleToShow.classList.remove('hidden')  
            if (tableToShow) tableToShow.classList.remove('hidden')
        }

        // Estado inicial: Industriales
        if (newIndustrialesButton) {
            initializeBackdrop(newIndustrialesButton)
            showTable(industrialesTitle, industrialesTable)
        }

        if (newIndustrialesButton) {
            newIndustrialesButton.addEventListener('click', () => {
                updateBackdrop(newIndustrialesButton)
                showTable(industrialesTitle, industrialesTable)
            })
        }

        if (newComercioButton) {
            newComercioButton.addEventListener('click', () => {
                updateBackdrop(newComercioButton)
                showTable(comercioTitle, comercioTable)
            })
        }
    }

    // Inicializar al cargar la página
    document.addEventListener('DOMContentLoaded', initializeCitySelector);

    // Inicializar después de cada transición de página (View Transitions)
    document.addEventListener('astro:page-load', initializeCitySelector);

    // También al cambiar de página sin View Transitions
    document.addEventListener('astro:after-swap', initializeCitySelector);
</script>