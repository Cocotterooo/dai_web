---
interface Props {
    stopId: number;
}

const { stopId } = Astro.props;
---

<div class="relative w-[300px] sm:w-[500px]">
	<table
		id={`incomingBuses-${stopId}`}
		data-stop-id={stopId}
		class="table-auto w-full bg-blue-950/80 text-white text-center rounded-lg overflow-hidden backdrop-blur-sm"
	>
		<thead>
		<tr class="bg-dai/20 border-b border-dai/60">
			<th class="py-3 px-4 w-[15px] sm:w-25 max-w-30">Línea</th>
			<th class="py-3 px-4">Ruta</th>
			<!-- Cambié el id por una clase -->
			<th class="time-column-header py-3 px-4 w-[15px] sm:w-25 max-w-30"></th>
		</tr>
		</thead>
		<tbody>
		<!-- filas dinámicas -->
		</tbody>
	</table>

	<!-- Overlay de error de conexión -->
	<div
		class="connection-error-overlay backdrop-blur-[1px] border-2 border-white/30 hidden absolute inset-0 bg-red-900/30 items-center justify-center text-white text-xl font-bold tracking-widest rounded-lg pointer-events-none"
	>
		<div class="relative w-full h-full flex items-center justify-center">
			<animated-icons
					class="absolute -z-2 opacity-50 translate-y-3"
					src='src/assets/icons/animated/wifi.json'
					aria-label={`Icono animado representando falta de consexión`}
					trigger="loop"
					height="300"
					width="300"
					speed="0.5"
				></animated-icons>
			<div class="flex flex-row gap-2 border-white/30 border-2 px-3 sm:px-6 py-1 sm:py-1backdrop-blur-[1px] bg-red-900/65 rounded-lg shadow-lg relative z-10 items-center">
				<span
					class="text-white/90 text-[16px] sm:text-[16px]"
				>
					Conectando...
				</span>
			</div>
		<!-- Líneas diagonales tipo HUD -->
		<div
			class="absolute top-0 left-0 w-px h-[120px] bg-white/30 transform rotate-[-57deg] origin-top-left ml-5 mt-5"
		></div>
		<div
			class="absolute top-0 right-0 w-px h-[120px] bg-white/30 transform rotate-57 origin-top-right mr-5 mt-5"
		></div>
		<div
			class="absolute bottom-0 left-0 w-px h-[120px] bg-white/30 transform rotate-57 origin-bottom-left ml-5 mb-5"
		></div>
		<div
			class="absolute bottom-0 right-0 w-px h-[120px] bg-white/30 transform rotate-[-57deg] origin-bottom-right mr-5 mb-5"
		></div>
		</div>
	</div>
</div>

<script type="module" is:inline>
    function initializeTimeHeaders() {
        const smBreakpoint = 640;

        function updateAllTimeHeaders() {
            const tables = document.querySelectorAll("table[data-stop-id]");
            tables.forEach((table) => {
                const timeHeader = table.querySelector(".time-column-header");
                if (!timeHeader) return;

                if (window.innerWidth < smBreakpoint) {
                    timeHeader.textContent = "Min";
                } else {
                    timeHeader.textContent = "Minutos";
                }
            });
        }

        updateAllTimeHeaders();

        // Limpiar event listeners existentes
        window.removeEventListener("resize", updateAllTimeHeaders);
        window.addEventListener("resize", updateAllTimeHeaders);
    }

    // Inicializar al cargar la página
    document.addEventListener("DOMContentLoaded", initializeTimeHeaders);

    // Inicializar después de cada navegación entre páginas
    document.addEventListener('astro:page-load', initializeTimeHeaders);

    // También al cambiar de página dinámicamente
    document.addEventListener('astro:after-swap', initializeTimeHeaders);
</script>
<script src="@/scripts/embed-animated-icons.js"></script>