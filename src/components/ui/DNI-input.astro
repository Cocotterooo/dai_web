---
---

<div>
    <label for="dni" class="block text-sm font-medium text-white/80 mb-1">
    DNI *
    </label>
    <input
    type="text"
    id="dni"
    name="dni"
    required
    pattern="[0-9]{8}[A-Za-z]"
    maxlength="9"
    class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-dai focus:border-transparent text-white placeholder-white/50"
    placeholder="12345678A"
    />
    <p id="dni-feedback" class="text-xs mt-1 transition-colors duration-300">
    <span class="text-white/60">Formato: 8 números + 1 letra</span>
    </p>
</div>

<script is:inline type="module">
    // Validación del DNI en tiempo real
    document.getElementById('dni').addEventListener('input', function() {
        const dniInput = this.value.toUpperCase();
        const dniNumber = dniInput.slice(0, 8);
        const dniLetter = dniInput[8];
        const feedback = document.getElementById('dni-feedback');
        
        // Limpiar validación personalizada
        this.setCustomValidity('');
        
        if (dniInput.length === 0) {
        // Campo vacío
        feedback.innerHTML = '<span class="text-white/60">Formato: 8 números + 1 letra</span>';
        this.classList.remove('border-green-400', 'border-red-400');
        this.classList.add('border-white/20');
        return;
        }
        
        if (dniInput.length < 8) {
        // Menos de 8 caracteres
        feedback.innerHTML = '<span class="text-yellow-400">Introduce el número completo del DNI.</span>';
        this.classList.remove('border-green-400', 'border-red-400');
        this.classList.add('border-yellow-400');
        return;
        }
        
        if (dniInput.length === 8) {
        // Exactamente 8 números, esperar la letra
        if (/^[0-9]{8}$/.test(dniNumber)) {
            feedback.innerHTML = '<span class="text-blue-400">Ahora introduce la letra del DNI</span>';
            this.classList.remove('border-green-400', 'border-red-400');
            this.classList.add('border-blue-400');
        } else {
            feedback.innerHTML = '<span class="text-red-400">Los primeros 8 caracteres deben ser números</span>';
            this.classList.remove('border-green-400', 'border-blue-400');
            this.classList.add('border-red-400');
            this.setCustomValidity('Los primeros 8 caracteres deben ser números.');
        }
        return;
        }
        
        if (dniInput.length === 9) {
        // DNI completo, validar
        const dniPattern = /^[0-9]{8}[A-Z]$/;
        
        if (dniPattern.test(dniInput)) {
            const expectedLetter = calculateDNILetter(parseInt(dniNumber));
            
            if (dniLetter === expectedLetter) {
            // DNI válido
            feedback.innerHTML = '<span class="text-green-400">✓ DNI válido</span>';
            this.classList.remove('border-red-400', 'border-blue-400', 'border-yellow-400');
            this.classList.add('border-green-400');
            } else {
            // DNI incorrecto
            feedback.innerHTML = `<span class="text-red-400">✗ DNI inválido.</span>`;
            this.classList.remove('border-green-400', 'border-blue-400', 'border-yellow-400');
            this.classList.add('border-red-400');
            this.setCustomValidity(`DNI inválido.`);
            }
        } else {
            // Formato incorrecto
            feedback.innerHTML = '<span class="text-red-400">✗ Formato incorrecto. Debe ser 8 números + 1 letra</span>';
            this.classList.remove('border-green-400', 'border-blue-400', 'border-yellow-400');
            this.classList.add('border-red-400');
            this.setCustomValidity('Formato incorrecto. Debe ser 8 números y 1 letra.');
        }
        }
        
        if (dniInput.length > 9) {
        // Más de 9 caracteres
        feedback.innerHTML = '<span class="text-red-400">✗ Demasiados caracteres. Máximo 9</span>';
        this.classList.remove('border-green-400', 'border-blue-400', 'border-yellow-400');
        this.classList.add('border-red-400');
        this.setCustomValidity('El DNI no puede tener más de 9 caracteres.');
        }
    });

    // También validar cuando pierda el foco para asegurar consistencia
    document.getElementById('dni').addEventListener('blur', function() {
        if (this.value.length > 0 && this.value.length < 9) {
        this.setCustomValidity('El DNI debe tener exactamente 9 caracteres.');
        }
    });

    // Función para calcular la letra correcta del DNI
    function calculateDNILetter(dni) {
        const letters = 'TRWAGMYFPDXBNJZSQVHLCKE';
        return letters[dni % 23];
    }
</script>
